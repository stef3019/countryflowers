!function(r){var f={menuFields:["menu-item-url","menu-item-title","menu-item-attr-title","menu-item-target","menu-item-classes","menu-item-xfn","menu-item-description","menu-item-featured-style","menu-item-featured-text","menu-item-icon","menu-submenu-width","menu-submenu-custom-width","menu-submenu-position","menu-submenu-transition"],menuSelectFieldDefault:{"menu-item-featured-style":"","menu-submenu-width":"auto","menu-submenu-position":"left","menu-submenu-transition":""},isSavingMenu:!1,init:function(){this.initXMenuData(),this.loadTemplates()},initXMenuData:function(){var e,n,a;for(a in xmenu_meta.data)for(xmenu_meta.data[a].is_changed=!1,e=0;e<f.menuFields.length;e++)n=f.menuFields[e],void 0===xmenu_meta.data[a][n]&&(n in f.menuSelectFieldDefault?xmenu_meta.data[a][n]=f.menuSelectFieldDefault[n]:xmenu_meta.data[a][n]="")},loadTemplates:function(){r.ajax({url:xmenu_meta.ajax_url,data:{action:"xmenu_get_xmenu_panel"},success:function(e){0==r("#xmenu_panel").length&&r("body").append('<div id="xmenu_panel"></div>'),r("#xmenu_panel").html(e),f.installListener(),f.initXMenuButton()}})},installListener:function(){var a=this,e=r(".xmenu-panel-wrapper"),n=e.find(".xmenu-button-close"),t=e.find(".xmenu-sections"),i=e.find(".xmenu-tabs li"),u=e.find('[name="menu-item-featured-style"]'),m=e.find('[name="menu-item-featured-text"]'),s=e.find("#xmenu_submenu_width"),d=e.find("#xmenu_submenu_custom_width"),o=e.find(".xmenu-icon-wrapper"),l=e.find(".xmenu-icon-remove");e.find(".xmenu-buttons");t.perfectScrollbar({wheelSpeed:.5,suppressScrollX:!0}),i.on("click",function(){var e=r(this).data("section");i.removeClass("active"),r(this).addClass("active"),t.find(".xmenu-section-item").removeClass("active"),t.find("#"+e).addClass("active"),t.perfectScrollbar("update")}),u.on("change",function(){""!=r(this).val()?m.parent().show():m.parent().hide()}),s.on("change",function(){"custom"===r(this).val()?d.parent().show():d.parent().hide()}),o.on("click",function(e){var n;0<r(e.target).closest(".xmenu-icon-remove").length||(n=o.find('[name="menu-item-icon"]'),GSF_ICON_POPUP.open(n.val(),function(e){a.setIcon(e),n.trigger("change")}))}),l.on("click",function(){f.setIcon("")}),n.on("click",function(){e.removeClass("in")}),this.windowKeyUp(),this.saveMenu(),this.saveAllMenu(),this.eventChangedForXmenuField()},saveMenu:function(){r(".xmenu-panel-wrapper").find(".xmenu-buttons").find(".xmenu-button-save").on("click",function(){var e=r(".xmenu-panel-wrapper").data("menu-id");null!=e&&f.saveMenuItems([e])})},saveAllMenu:function(){var e=r(".xmenu-panel-wrapper").find(".xmenu-buttons");e.find(" > span").on("click",function(){e.find(".xmenu-save-all").fadeToggle()}),r("body").on("click",function(e){r(e.target).closest(".xmenu-buttons > span").length||r(".xmenu-save-all").fadeOut()}),e.find(".xmenu-save-all").on("click",function(){var e,n=[],a=0;for(e in xmenu_meta.data)xmenu_meta.data[e].is_changed&&(n[a++]=parseInt(e.replace("menu_",""),10));f.saveMenuItems(n)})},eventChangedForXmenuField:function(){for(var e,t=r(".xmenu-panel-wrapper"),n=0;n<f.menuFields.length;n++)e=f.menuFields[n],t.find('[name="'+e+'"]').on("change",function(){var e=r(this),n=t.data("menu-id"),a=e.attr("name");xmenu_meta.data["menu_"+n].is_changed=!0,r("#menu-item-"+n).find(".xmenu-item-config").addClass("is-changed"),"menu-item-target"!==a||e.prop("checked")?xmenu_meta.data["menu_"+n][a]=e.val():xmenu_meta.data["menu_"+n][a]="";n=r("#menu-item-"+n).find('[name="'+a+"["+n+']"]');"menu-item-target"===a?n.prop("checked",e.prop("checked")):n.val(e.val()),n.trigger("change")})},initXMenuButton:function(){r("ul.menu > li.menu-item").each(function(){var e=parseInt(r(this).attr("id").replace("menu-item-",""),10);r("> .menu-item-bar > .menu-item-handle > .item-title",this).append('<span class="xmenu-item-config" data-id="'+e+'"><i class="fa fa-cogs"></i> XMENU <i class="fa fa-warning"></i></span>')}),r("ul.menu > li.menu-item .xmenu-item-config").on("click",function(){var e=parseInt(r(this).attr("data-id"),10);f.openXMenuPanel(e)})},openXMenuPanel:function(e){var n=r(".xmenu-panel-wrapper");if(!n.hasClass(".xmenu-is-saving")){n.data("menu-id",e),n.addClass("in");var a,t,i,u=r(".xmenu-panel-wrapper"),m=u.find(".xmenu-icon-wrapper"),s=m.find(".xmenu-icon > div > i"),d=u.find("#xmenu_item_url"),o=u.find('[name="menu-item-featured-style"]'),l=u.find('[name="menu-item-featured-text"]'),c=u.find(".xmenu-title"),n=u.find("#xmenu_submenu_width");for(c.text(xmenu_meta.data["menu_"+e]["menu-item-title"]),"custom"===xmenu_meta.data["menu_"+e].type?d.removeAttr("readonly"):d.attr("readonly","readonly"),i=0;i<f.menuFields.length;i++)t=f.menuFields[i],a=u.find('[name="'+t+'"]'),"menu-item-target"===t?a.prop("checked","_blank"===xmenu_meta.data["menu_"+e][t]):a.val(xmenu_meta.data["menu_"+e][t]),"menu-item-icon"===t&&(s.attr("class",xmenu_meta.data["menu_"+e][t]),""!==xmenu_meta.data["menu_"+e][t]?m.addClass("has-icon"):m.removeClass("has-icon"));""!==o.val()?l.parent().show():l.parent().hide(),n.trigger("change")}},setIcon:function(e){var n=r(".xmenu-icon-wrapper"),a=n.find('[name="menu-item-icon"]'),t=n.find(".xmenu-icon > div > i");a.val(e),t.attr("class",e),""==e?n.removeClass("has-icon"):n.addClass("has-icon"),a.trigger("change")},windowKeyUp:function(){r(window).on("keyup",function(e){27==(e.keyCode||e.which)&&((e=r(".xmenu-panel-wrapper")).hasClass("in")?e.removeClass("in"):void 0!==e.data("menu-id")&&e.addClass("in"),r(".xmenu-icon-popup").fadeOut(),r(".xmenu-save-all").fadeOut())})},saveMenuItems:function(e){if(!f.isSavingMenu){f.isSavingMenu=!0;var n,a=r(".xmenu-button-save"),t=[],i=e.length;for(a.find("span").text(a.data("saving")),a.find("i").addClass("fa-spin fa-spinner"),n=0;n<i;n++)t[n]={menu_id:e[n],data:xmenu_meta.data["menu_"+e[n]]};r.ajax({url:xmenu_meta.ajax_url,type:"POST",data:{action:"xmenu_save_menu",data:t,nonce:r("#xmenu_nonce").val()},success:function(){for(f.isSavingMenu=!1,a.find("span").text(a.data("save")),a.find("i").removeClass("fa-spin fa-spinner"),n=0;n<i;n++)xmenu_meta.data["menu_"+e[n]].is_changed=!1,r("#menu-item-"+e[n]).find(".xmenu-item-config").removeClass("is-changed")},error:function(){f.isSavingMenu=!1,a.find("span").text(a.data("save")),a.find("i").removeClass("fa-spin fa-spinner")}})}}};r(document).ready(function(){f.init()})}(jQuery);